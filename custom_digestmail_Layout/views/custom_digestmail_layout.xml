<odoo>
  <template id="digest_mail_custom" inherit_id="digest.digest_mail_layout" name="Custom Company Weekly Digest Email">

    <!-- Custom header -->
    <xpath expr="//div[@class='o_digest_header']" position="replace">
      <div style="background-color:#003366; color:white; text-align:center; padding:30px 10px; border-radius:8px 8px 0 0;">
        <img src="/web/image/res.company,%(object.company_id.id)s,logo" alt="Company Logo"
             style="max-height:60px; margin-bottom:10px;"/>
        <h2 style="margin:0; font-size:22px;">Weekly Business Digest</h2>
        <p style="margin:5px 0; font-size:14px;">A quick summary of your companyâ€™s performance this week</p>
      </div>
    </xpath>

    <!-- Add custom summary section -->
    <xpath expr="//div[contains(@class,'o_digest_body')]" position="before">
      <div style="padding:20px; background:#f8f9fb; border-bottom:1px solid #ddd;">
        <h3 style="color:#003366; border-bottom:2px solid #003366; display:inline-block; padding-bottom:4px;">ğŸ“ˆ Weekly Summary</h3>
        <p style="margin-top:10px; font-size:14px; color:#444;">
          Hereâ€™s what happened in your business over the past 7 days.
        </p>
      </div>
    </xpath>

    <!-- Replace KPI area with custom data -->
    <xpath expr="//div[contains(@class,'o_digest_body')]" position="replace">
      <div class="o_digest_body" style="padding:25px;">
        <table style="width:100%; border-collapse:collapse; text-align:center;">
          <tr style="background-color:#e6f0ff; font-weight:bold;">
            <td style="padding:10px;">Metric</td>
            <td style="padding:10px;">This Week</td>
          </tr>
          <tr>
            <td style="padding:10px; border-bottom:1px solid #ddd;">ğŸ’° Total Sales Orders Confirmed</td>
            <td style="padding:10px; border-bottom:1px solid #ddd;">
              <t t-esc="env['sale.order'].search_count([('state','=','sale'),('create_date','>=',(datetime.datetime.now() - datetime.timedelta(days=7)))])"/>
            </td>
          </tr>
          <tr>
            <td style="padding:10px; border-bottom:1px solid #ddd;">ğŸ“¦ Total Invoices Posted</td>
            <td style="padding:10px; border-bottom:1px solid #ddd;">
              <t t-esc="env['account.move'].search_count([('move_type','=','out_invoice'),('state','=','posted'),('invoice_date','>=',(datetime.datetime.now() - datetime.timedelta(days=7)))])"/>
            </td>
          </tr>
          <tr>
            <td style="padding:10px; border-bottom:1px solid #ddd;">ğŸ§¾ Total Invoice Amount</td>
            <td style="padding:10px; border-bottom:1px solid #ddd;">
              â‚¹<t t-esc="sum(env['account.move'].search([('move_type','=','out_invoice'),('state','=','posted'),('invoice_date','>=',(datetime.datetime.now() - datetime.timedelta(days=7)))]).mapped('amount_total'))"/>
            </td>
          </tr>
          <tr>
            <td style="padding:10px; border-bottom:1px solid #ddd;">ğŸ§ New Customers Added</td>
            <td style="padding:10px; border-bottom:1px solid #ddd;">
              <t t-esc="env['res.partner'].search_count([('customer_rank','>',0),('create_date','>=',(datetime.datetime.now() - datetime.timedelta(days=7)))])"/>
            </td>
          </tr>
          <tr>
            <td style="padding:10px;">ğŸ“§ New Leads (CRM)</td>
            <td style="padding:10px;">
              <t t-esc="env['crm.lead'].search_count([('create_date','>=',(datetime.datetime.now() - datetime.timedelta(days=7)))])"/>
            </td>
          </tr>
        </table>
      </div>
    </xpath>

    <!-- Add footer -->
    <xpath expr="//div[@class='o_digest_footer']" position="replace">
      <div class="o_digest_footer" style="background:#003366; color:white; text-align:center; padding:20px; border-radius:0 0 8px 8px;">
        <p style="margin:0;">Thank you for being part of our journey ğŸ’¼</p>
        <p style="margin:0; font-size:12px; color:#ccc;">
          Â© <t t-esc="datetime.date.today().year"/> Your Company Name. All rights reserved.
        </p>
      </div>
    </xpath>

  </template>
</odoo>
